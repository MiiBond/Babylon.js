var BABYLON;BABYLON.Effect.ShadersStore.textureTransformPixelShader="precision highp float;\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform mat4 textureTransformMat;\nvoid main(void) {\nvec2 uvTransformed=(textureTransformMat*vec4(vUV.xy,1,1)).xy;\ngl_FragColor=texture2D(textureSampler,uvTransformed);\n}",(function(i){var e=(function(){function e(){}return e.GLTFAsync=function(t,r,n){return t.whenReadyAsync().then((function(){var e=r.replace(/\.[^/.]+$/,"");return new i.GLTF2.Exporter._Exporter(t,n)._generateGLTFAsync(e)}))},e._PreExportAsync=function(e,t){return Promise.resolve().then((function(){return t&&t.exportWithoutWaitingForScene?Promise.resolve():e.whenReadyAsync()}))},e._PostExportAsync=function(e,t,r){return Promise.resolve().then((function(){return r&&r.exportWithoutWaitingForScene,t}))},e.GLBAsync=function(t,r,n){var a=this;return this._PreExportAsync(t,n).then((function(){var e=r.replace(/\.[^/.]+$/,"");return new i.GLTF2.Exporter._Exporter(t,n)._generateGLBAsync(e).then((function(e){return a._PostExportAsync(t,e,n)}))}))},e})();i.GLTF2Export=e})(BABYLON||(BABYLON={})),(function(W){var e;(function(z){var e=(function(){function u(e,t){this._extensions={},this._asset={generator:"BabylonJS",version:"2.0"},this._extensionsUsed=[],this._extensionsRequired=[],this._babylonScene=e,this._bufferViews=[],this._accessors=[],this._meshes=[],this._scenes=[],this._nodes=[],this._images=[],this._materials=[],this._materialMap=[],this._textures=[],this._samplers=[],this._animations=[],this._imageData={},this._convertToRightHandedSystem=!this._babylonScene.useRightHandedSystem;var r=t||{};this._shouldExportTransformNode=r.shouldExportTransformNode?r.shouldExportTransformNode:function(e){return!0},this._animationSampleRate=r.animationSampleRate?r.animationSampleRate:1/60,this._glTFMaterialExporter=new z._GLTFMaterialExporter(this),this._loadExtensions()}return u.prototype._applyExtensions=function(e,t){for(var r=0,n=u._ExtensionNames;r<n.length;r++){var a=n[r],i=this._extensions[a];if(i.enabled){var o=e;o._activeLoaderExtensions=o._activeLoaderExtensions||{};var s=o._activeLoaderExtensions;if(!s[a]){s[a]=!0;try{var l=t(i);if(l)return l}finally{delete s[a],delete o._activeLoaderExtensions}}}}return null},u.prototype._extensionsPreExportTextureAsync=function(t,r,n){return this._applyExtensions(r,(function(e){return e.preExportTextureAsync&&e.preExportTextureAsync(t,r,n)}))},u.prototype._extensionsPostExportMeshPrimitiveAsync=function(t,r,n,a){return this._applyExtensions(r,(function(e){return e.postExportMeshPrimitiveAsync&&e.postExportMeshPrimitiveAsync(t,r,n,a)}))},u.prototype._loadExtensions=function(){for(var e=0,t=u._ExtensionNames;e<t.length;e++){var r=t[e],n=u._ExtensionFactories[r](this);this._extensions[r]=n}},u.RegisterExtension=function(e,t){u.UnregisterExtension(e)&&W.Tools.Warn("Extension with the name "+e+" already exists"),u._ExtensionFactories[e]=t,u._ExtensionNames.push(e)},u.UnregisterExtension=function(e){if(!u._ExtensionFactories[e])return!1;delete u._ExtensionFactories[e];var t=u._ExtensionNames.indexOf(e);return-1!==t&&u._ExtensionNames.splice(t,1),!0},u.prototype._getLocalEngine=function(){if(!this._localEngine){var e=document.createElement("canvas");e.id="WriteCanvas",e.width=2048,e.height=2048,this._localEngine=new W.Engine(e,!0,{premultipliedAlpha:!1,preserveDrawingBuffer:!0}),this._localEngine.setViewport(new W.Viewport(0,0,1,1))}return this._localEngine},u.prototype.reorderIndicesBasedOnPrimitiveMode=function(e,t,r,n,a){switch(t){case W.Material.TriangleFillMode:n||(n=0);for(var i=e.indexStart,o=e.indexStart+e.indexCount;i<o;i+=3){var s=n+4*i,l=a.getUInt32(s+4),u=a.getUInt32(s+8);a.setUInt32(u,s+4),a.setUInt32(l,s+8)}break;case W.Material.TriangleFanDrawMode:i=e.indexStart+e.indexCount-1;for(var c=e.indexStart;c<=i;--i)a.setUInt32(r[i],n),n+=4;break;case W.Material.TriangleStripDrawMode:3<=e.indexCount&&(a.setUInt32(r[e.indexStart+2],n+4),a.setUInt32(r[e.indexStart+1],n+8))}},u.prototype.reorderVertexAttributeDataBasedOnPrimitiveMode=function(e,t,r,n,a,i,o){if(this._convertToRightHandedSystem&&r===W.Material.ClockWiseSideOrientation)switch(t){case W.Material.TriangleFillMode:this.reorderTriangleFillMode(e,t,r,n,a,i,o);break;case W.Material.TriangleStripDrawMode:this.reorderTriangleStripDrawMode(e,t,r,n,a,i,o);break;case W.Material.TriangleFanDrawMode:this.reorderTriangleFanMode(e,t,r,n,a,i,o)}},u.prototype.reorderTriangleFillMode=function(e,t,r,n,a,i,o){var s=this.getVertexBufferFromMesh(n,e.getMesh());if(s){var l=s.byteStride/W.VertexBuffer.GetTypeByteLength(s.type);if(e.verticesCount%3!=0)W.Tools.Error("The submesh vertices for the triangle fill mode is not divisible by 3!");else{var u=[],c=0;switch(n){case W.VertexBuffer.PositionKind:case W.VertexBuffer.NormalKind:for(var h=e.verticesStart;h<e.verticesStart+e.verticesCount;h+=3)c=h*l,u.push(W.Vector3.FromArray(a,c)),u.push(W.Vector3.FromArray(a,c+2*l)),u.push(W.Vector3.FromArray(a,c+l));break;case W.VertexBuffer.TangentKind:for(h=e.verticesStart;h<e.verticesStart+e.verticesCount;h+=3)c=h*l,u.push(W.Vector4.FromArray(a,c)),u.push(W.Vector4.FromArray(a,c+2*l)),u.push(W.Vector4.FromArray(a,c+l));break;case W.VertexBuffer.ColorKind:var f=s.getSize();for(h=e.verticesStart;h<e.verticesStart+e.verticesCount;h+=f)c=h*l,4===f?(u.push(W.Vector4.FromArray(a,c)),u.push(W.Vector4.FromArray(a,c+2*l)),u.push(W.Vector4.FromArray(a,c+l))):(u.push(W.Vector3.FromArray(a,c)),u.push(W.Vector3.FromArray(a,c+2*l)),u.push(W.Vector3.FromArray(a,c+l)));break;case W.VertexBuffer.UVKind:case W.VertexBuffer.UV2Kind:for(h=e.verticesStart;h<e.verticesStart+e.verticesCount;h+=3)c=h*l,u.push(W.Vector2.FromArray(a,c)),u.push(W.Vector2.FromArray(a,c+2*l)),u.push(W.Vector2.FromArray(a,c+l));break;default:W.Tools.Error("Unsupported Vertex Buffer type: "+n)}this.writeVertexAttributeData(u,i,n,a,o)}}else W.Tools.Warn("reorderTriangleFillMode: Vertex Buffer Kind "+n+" not present!")},u.prototype.reorderTriangleStripDrawMode=function(e,t,r,n,a,i,o){var s=this.getVertexBufferFromMesh(n,e.getMesh());if(s){var l=s.byteStride/W.VertexBuffer.GetTypeByteLength(s.type),u=[],c=0;switch(n){case W.VertexBuffer.PositionKind:case W.VertexBuffer.NormalKind:c=e.verticesStart,u.push(W.Vector3.FromArray(a,c+2*l)),u.push(W.Vector3.FromArray(a,c+l));break;case W.VertexBuffer.TangentKind:for(var h=e.verticesStart+e.verticesCount-1;h>=e.verticesStart;--h)c=h*l,u.push(W.Vector4.FromArray(a,c));break;case W.VertexBuffer.ColorKind:for(h=e.verticesStart+e.verticesCount-1;h>=e.verticesStart;--h)c=h*l,4===s.getSize()?u.push(W.Vector4.FromArray(a,c)):u.push(W.Vector3.FromArray(a,c));break;case W.VertexBuffer.UVKind:case W.VertexBuffer.UV2Kind:for(h=e.verticesStart+e.verticesCount-1;h>=e.verticesStart;--h)c=h*l,u.push(W.Vector2.FromArray(a,c));break;default:W.Tools.Error("Unsupported Vertex Buffer type: "+n)}this.writeVertexAttributeData(u,i+12,n,a,o)}else W.Tools.Warn("reorderTriangleStripDrawMode: Vertex buffer kind "+n+" not present!")},u.prototype.reorderTriangleFanMode=function(e,t,r,n,a,i,o){var s=this.getVertexBufferFromMesh(n,e.getMesh());if(s){var l=s.byteStride/W.VertexBuffer.GetTypeByteLength(s.type),u=[],c=0;switch(n){case W.VertexBuffer.PositionKind:case W.VertexBuffer.NormalKind:for(var h=e.verticesStart+e.verticesCount-1;h>=e.verticesStart;--h)c=h*l,u.push(W.Vector3.FromArray(a,c));break;case W.VertexBuffer.TangentKind:for(h=e.verticesStart+e.verticesCount-1;h>=e.verticesStart;--h)c=h*l,u.push(W.Vector4.FromArray(a,c));break;case W.VertexBuffer.ColorKind:for(h=e.verticesStart+e.verticesCount-1;h>=e.verticesStart;--h)c=h*l,u.push(W.Vector4.FromArray(a,c)),4===s.getSize()?u.push(W.Vector4.FromArray(a,c)):u.push(W.Vector3.FromArray(a,c));break;case W.VertexBuffer.UVKind:case W.VertexBuffer.UV2Kind:for(h=e.verticesStart+e.verticesCount-1;h>=e.verticesStart;--h)c=h*l,u.push(W.Vector2.FromArray(a,c));break;default:W.Tools.Error("Unsupported Vertex Buffer type: "+n)}this.writeVertexAttributeData(u,i,n,a,o)}else W.Tools.Warn("reorderTriangleFanMode: Vertex buffer kind "+n+" not present!")},u.prototype.writeVertexAttributeData=function(e,t,r,n,a){for(var i=0,o=e;i<o.length;i++){var s=o[i];!this._convertToRightHandedSystem||r===W.VertexBuffer.ColorKind||s instanceof W.Vector2||(s instanceof W.Vector3?r===W.VertexBuffer.NormalKind?z._GLTFUtilities._GetRightHandedNormalVector3FromRef(s):r===W.VertexBuffer.PositionKind?z._GLTFUtilities._GetRightHandedPositionVector3FromRef(s):W.Tools.Error("Unsupported vertex attribute kind!"):z._GLTFUtilities._GetRightHandedVector4FromRef(s)),r===W.VertexBuffer.NormalKind?s.normalize():r===W.VertexBuffer.TangentKind&&s instanceof W.Vector4&&z._GLTFUtilities._NormalizeTangentFromRef(s);for(var l=0,u=s.asArray();l<u.length;l++){var c=u[l];a.setFloat32(c,t),t+=4}}},u.prototype.writeAttributeData=function(e,t,r,n){var a,i=r/4,o=[];switch(e){case W.VertexBuffer.PositionKind:for(var s=0,l=t.length/i;s<l;++s){a=s*i;var u=W.Vector3.FromArray(t,a);this._convertToRightHandedSystem&&z._GLTFUtilities._GetRightHandedPositionVector3FromRef(u),o.push(u.asArray())}break;case W.VertexBuffer.NormalKind:s=0;for(var c=t.length/i;s<c;++s)a=s*i,u=W.Vector3.FromArray(t,a),this._convertToRightHandedSystem&&z._GLTFUtilities._GetRightHandedNormalVector3FromRef(u),u.normalize(),o.push(u.asArray());break;case W.VertexBuffer.TangentKind:s=0;for(var h=t.length/i;s<h;++s)a=s*i,u=W.Vector4.FromArray(t,a),this._convertToRightHandedSystem&&z._GLTFUtilities._GetRightHandedVector4FromRef(u),z._GLTFUtilities._NormalizeTangentFromRef(u),o.push(u.asArray());break;case W.VertexBuffer.ColorKind:s=0;for(var f=t.length/i;s<f;++s)a=s*i,u=3===i?W.Vector3.FromArray(t,a):W.Vector4.FromArray(t,a),o.push(u.asArray());break;case W.VertexBuffer.UVKind:case W.VertexBuffer.UV2Kind:s=0;for(var p=t.length/i;s<p;++s)a=s*i,o.push((this._convertToRightHandedSystem,[t[a],t[a+1]]));break;default:W.Tools.Warn("Unsupported Vertex Buffer Type: "+e),o=[]}for(var m=0,d=o;m<d.length;m++)for(var T=0,g=d[m];T<g.length;T++){var _=g[T];n.setFloat32(_)}},u.prototype.generateJSON=function(e,t,r){var n,a,i,o=this,s={byteLength:this._totalByteLength},l=this._totalByteLength,u={asset:this._asset};return this._extensionsUsed&&this._extensionsUsed.length&&(u.extensionsUsed=this._extensionsUsed),this._extensionsRequired&&this._extensionsRequired.length&&(u.extensionsRequired=this._extensionsRequired),s.byteLength&&(u.buffers=[s]),this._nodes&&this._nodes.length&&(u.nodes=this._nodes),this._meshes&&this._meshes.length&&(u.meshes=this._meshes),this._scenes&&this._scenes.length&&(u.scenes=this._scenes,u.scene=0),this._bufferViews&&this._bufferViews.length&&(u.bufferViews=this._bufferViews),this._accessors&&this._accessors.length&&(u.accessors=this._accessors),this._animations&&this._animations.length&&(u.animations=this._animations),this._materials&&this._materials.length&&(u.materials=this._materials),this._textures&&this._textures.length&&(u.textures=this._textures),this._samplers&&this._samplers.length&&(u.samplers=this._samplers),this._images&&this._images.length&&(e?(u.images=[],this._images.forEach((function(e){e.uri&&(a=o._imageData[e.uri],n=e.uri.split(".")[0]+" image",i=z._GLTFUtilities._CreateBufferView(0,l,a.data.length,void 0,n),l+=a.data.buffer.byteLength,o._bufferViews.push(i),e.bufferView=o._bufferViews.length-1,e.name=n,e.mimeType=a.mimeType,e.uri=void 0,u.images||(u.images=[]),u.images.push(e))})),s.byteLength=l):u.images=this._images),e||(s.uri=t+".bin"),r?JSON.stringify(u,null,2):JSON.stringify(u)},u.prototype._generateGLTFAsync=function(s){var l=this;return this._generateBinaryAsync().then((function(e){var t=l.generateJSON(!1,s,!0),r=new Blob([e],{type:"application/octet-stream"}),n=s+".gltf",a=s+".bin",i=new W.GLTFData;if(i.glTFFiles[n]=t,i.glTFFiles[a]=r,l._imageData)for(var o in l._imageData)i.glTFFiles[o]=new Blob([l._imageData[o].data],{type:l._imageData[o].mimeType});return i}))},u.prototype._generateBinaryAsync=function(){var e=this,t=new r(4);return this.createSceneAsync(this._babylonScene,t).then((function(){return e._localEngine&&e._localEngine.dispose(),t.getArrayBuffer()}))},u.prototype._getPadding=function(e){var t=e%4;return 0===t?t:4-t},u.prototype._generateGLBAsync=function(b){var R=this;return this._generateBinaryAsync().then((function(e){var t=R.generateJSON(!0),r=b+".glb",n=t.length,a=0;for(var i in R._imageData)a+=R._imageData[i].data.byteLength;var o=R._getPadding(n),s=R._getPadding(e.byteLength),l=R._getPadding(a),u=28+n+o+e.byteLength+s+a+l,c=new ArrayBuffer(12),h=new DataView(c);h.setUint32(0,1179937895,!0),h.setUint32(4,2,!0),h.setUint32(8,u,!0);var f=new ArrayBuffer(8+n+o),p=new DataView(f);p.setUint32(0,n+o,!0),p.setUint32(4,1313821514,!0);for(var m=new Uint8Array(f,8),d=0;d<n;++d)m[d]=t.charCodeAt(d);var T=new Uint8Array(f,8+n);for(d=0;d<o;++d)T[d]=32;var g=new ArrayBuffer(8),_=new DataView(g);_.setUint32(0,e.byteLength+a+l,!0),_.setUint32(4,5130562,!0);var y=new ArrayBuffer(s),x=new Uint8Array(y);for(d=0;d<s;++d)x[d]=0;var A=new ArrayBuffer(l),v=new Uint8Array(A);for(d=0;d<l;++d)v[d]=0;var F=[c,f,g,e];for(var i in R._imageData)F.push(R._imageData[i].data.buffer);F.push(y),F.push(A);var E=new Blob(F,{type:"application/octet-stream"}),M=new W.GLTFData;return M.glTFFiles[r]=E,null!=R._localEngine&&R._localEngine.dispose(),M}))},u.prototype.setNodeTransformation=function(e,t){t.getPivotPoint().equalsToFloats(0,0,0)||W.Tools.Warn("Pivot points are not supported in the glTF serializer"),t.position.equalsToFloats(0,0,0)||(e.translation=this._convertToRightHandedSystem?z._GLTFUtilities._GetRightHandedPositionVector3(t.position).asArray():t.position.asArray()),t.scaling.equalsToFloats(1,1,1)||(e.scale=t.scaling.asArray());var r=W.Quaternion.RotationYawPitchRoll(t.rotation.y,t.rotation.x,t.rotation.z);t.rotationQuaternion&&r.multiplyInPlace(t.rotationQuaternion),0===r.x&&0===r.y&&0===r.z&&1===r.w||(this._convertToRightHandedSystem&&z._GLTFUtilities._GetRightHandedQuaternionFromRef(r),e.rotation=r.normalize().asArray())},u.prototype.getVertexBufferFromMesh=function(e,t){if(t.isVerticesDataPresent(e)){var r=t.getVertexBuffer(e);if(r)return r}return null},u.prototype.createBufferViewKind=function(e,t,r,n){var a=t instanceof W.Mesh?t:t instanceof W.InstancedMesh?t.sourceMesh:null;if(a){var i=a.getVerticesData(e);if(i){var o=4*i.length,s=z._GLTFUtilities._CreateBufferView(0,r.getByteOffset(),o,n,e+" - "+a.name);this._bufferViews.push(s),this.writeAttributeData(e,i,n,r)}}},u.prototype.getMeshPrimitiveMode=function(e){return e instanceof W.LinesMesh?W.Material.LineListDrawMode:e.material?e.material.fillMode:W.Material.TriangleFillMode},u.prototype.setPrimitiveMode=function(e,t){switch(t){case W.Material.TriangleFillMode:break;case W.Material.TriangleStripDrawMode:e.mode=MeshPrimitiveMode.TRIANGLE_STRIP;break;case W.Material.TriangleFanDrawMode:e.mode=MeshPrimitiveMode.TRIANGLE_FAN;break;case W.Material.PointListDrawMode:e.mode=MeshPrimitiveMode.POINTS;case W.Material.PointFillMode:e.mode=MeshPrimitiveMode.POINTS;break;case W.Material.LineLoopDrawMode:e.mode=MeshPrimitiveMode.LINE_LOOP;break;case W.Material.LineListDrawMode:e.mode=MeshPrimitiveMode.LINES;break;case W.Material.LineStripDrawMode:e.mode=MeshPrimitiveMode.LINE_STRIP}},u.prototype.setAttributeKind=function(e,t){switch(t){case W.VertexBuffer.PositionKind:e.attributes.POSITION=this._accessors.length-1;break;case W.VertexBuffer.NormalKind:e.attributes.NORMAL=this._accessors.length-1;break;case W.VertexBuffer.ColorKind:e.attributes.COLOR_0=this._accessors.length-1;break;case W.VertexBuffer.TangentKind:e.attributes.TANGENT=this._accessors.length-1;break;case W.VertexBuffer.UVKind:e.attributes.TEXCOORD_0=this._accessors.length-1;break;case W.VertexBuffer.UV2Kind:e.attributes.TEXCOORD_1=this._accessors.length-1;break;default:W.Tools.Warn("Unsupported Vertex Buffer Type: "+t)}},u.prototype.setPrimitiveAttributesAsync=function(e,t,r){var n,a,i,o=[],s=null;t instanceof W.Mesh?s=t:t instanceof W.InstancedMesh&&(s=t.sourceMesh);var l=[{kind:W.VertexBuffer.PositionKind,accessorType:AccessorType.VEC3,byteStride:12},{kind:W.VertexBuffer.NormalKind,accessorType:AccessorType.VEC3,byteStride:12},{kind:W.VertexBuffer.ColorKind,accessorType:AccessorType.VEC4,byteStride:16},{kind:W.VertexBuffer.TangentKind,accessorType:AccessorType.VEC4,byteStride:16},{kind:W.VertexBuffer.UVKind,accessorType:AccessorType.VEC2,byteStride:8},{kind:W.VertexBuffer.UV2Kind,accessorType:AccessorType.VEC2,byteStride:8}];if(s){for(var u=null,c=this.getMeshPrimitiveMode(s),h={},f=0,p=l;f<p.length;f++){var m=(D=p[f]).kind;if(s.isVerticesDataPresent(m)){var d=this.getVertexBufferFromMesh(m,s);D.byteStride=d?4*d.getSize():4*W.VertexBuffer.DeduceStride(m),12===D.byteStride&&(D.accessorType=AccessorType.VEC3),this.createBufferViewKind(m,t,r,D.byteStride),D.bufferViewIndex=this._bufferViews.length-1,h[m]=D.bufferViewIndex}}if(s.getTotalIndices()){var T=s.getIndices();if(T){var g=4*T.length;n=z._GLTFUtilities._CreateBufferView(0,r.getByteOffset(),g,void 0,"Indices - "+s.name),this._bufferViews.push(n),u=this._bufferViews.length-1;for(var _=0,y=T.length;_<y;++_)r.setUInt32(T[_])}}if(s.subMeshes)for(var x=0,A=s.subMeshes;x<A.length;x++){var v=A[x];a=!1;var F=v.getMaterial()||s.getScene().defaultMaterial,E=null;if(F)if(s instanceof W.LinesMesh){var M={name:s.name+" material"};(!s.color.equals(W.Color3.White())||s.alpha<1)&&(M.pbrMetallicRoughness={baseColorFactor:s.color.asArray().concat([s.alpha])}),this._materials.push(M),E=this._materials.length-1}else if(F instanceof W.MultiMaterial){var b=F.subMaterials[v.materialIndex];b&&(F=b,E=this._materialMap[F.uniqueId])}else E=this._materialMap[F.uniqueId];var R=null!=E?this._materials[E]:null,S={attributes:{}};this.setPrimitiveMode(S,c);for(var C=0,V=l;C<V.length;C++)if(((m=(D=V[C]).kind)!==W.VertexBuffer.UVKind&&m!==W.VertexBuffer.UV2Kind||!R||this._glTFMaterialExporter._hasTexturesPresent(R))&&(U=s.getVerticesData(m))&&(d=this.getVertexBufferFromMesh(m,s))){var N=d.getSize(),B=D.bufferViewIndex;if(null!=B){i={min:null,max:null},m==W.VertexBuffer.PositionKind&&(i=z._GLTFUtilities._CalculateMinMaxPositions(U,0,U.length/N,this._convertToRightHandedSystem));var P=z._GLTFUtilities._CreateAccessor(B,m+" - "+t.name,D.accessorType,AccessorComponentType.FLOAT,U.length/N,0,i.min,i.max);this._accessors.push(P),this.setAttributeKind(S,m),null==S.attributes.TEXCOORD_0&&null==S.attributes.TEXCOORD_1||(a=!0)}}if(u&&(P=z._GLTFUtilities._CreateAccessor(u,"indices - "+t.name,AccessorType.SCALAR,AccessorComponentType.UNSIGNED_INT,v.indexCount,4*v.indexStart,null,null),this._accessors.push(P),S.indices=this._accessors.length-1),null!=E&&0<Object.keys(S.attributes).length){var L=F.sideOrientation;if(this._convertToRightHandedSystem&&L===W.Material.ClockWiseSideOrientation){var w=null!=u?this._bufferViews[u].byteOffset:null;null==w&&(w=0);var I=null;if(null!=u&&(I=s.getIndices()),I)this.reorderIndicesBasedOnPrimitiveMode(v,c,I,w,r);else for(var G=0,O=l;G<O.length;G++){var U,D=O[G];if(U=s.getVerticesData(D.kind)){var k=this._bufferViews[h[D.kind]].byteOffset;k||(k=0),this.reorderVertexAttributeDataBasedOnPrimitiveMode(v,c,L,D.kind,U,k,r)}}}if(!a&&this._glTFMaterialExporter._hasTexturesPresent(this._materials[E])){var K=this._glTFMaterialExporter._stripTexturesFromMaterial(this._materials[E]);this._materials.push(K),E=this._materials.length-1}S.material=E}e.primitives.push(S),this._extensionsPostExportMeshPrimitiveAsync("postExport",S,v,r)&&o.push()}}return Promise.all(o).then((function(){}))},u.prototype.createSceneAsync=function(e,l){var u,c,h,f=this,p={nodes:[]},m=e.transformNodes.concat(e.meshes);return this._glTFMaterialExporter._convertMaterialsToGLTFAsync(e.materials,ImageMimeType.PNG,!0).then((function(){return f.createNodeMapAndAnimationsAsync(e,m,f._shouldExportTransformNode,l).then((function(e){if(f._nodeMap=e,f._totalByteLength=l.getByteOffset(),null==f._totalByteLength)throw new Error("undefined byte length!");for(var t=0,r=m;t<r.length;t++){var n=r[t];if(null!=(u=f._nodeMap[n.uniqueId])&&(c=f._nodes[u],n.parent||(f._shouldExportTransformNode(n)?(f._convertToRightHandedSystem&&(c.translation&&(c.translation[2]*=-1,c.translation[0]*=-1),c.rotation=c.rotation?W.Quaternion.FromArray([0,1,0,0]).multiply(W.Quaternion.FromArray(c.rotation)).asArray():W.Quaternion.FromArray([0,1,0,0]).asArray()),p.nodes.push(u)):W.Tools.Log("Omitting "+n.name+" from scene.")),h=n.getDescendants(!0),!c.children&&h&&h.length)){for(var a=[],i=0,o=h;i<o.length;i++){var s=o[i];null!=f._nodeMap[s.uniqueId]&&a.push(f._nodeMap[s.uniqueId])}a.length&&(c.children=a)}}p.nodes.length&&f._scenes.push(p)}))}))},u.prototype.createNodeMapAndAnimationsAsync=function(r,e,n,a){for(var i,o=this,s=Promise.resolve(),l={},u={name:"runtime animations",channels:[],samplers:[]},c=[],t=function(t){n(t)?s=s.then((function(){return o.createNodeAsync(t,a).then((function(e){(t.getDescendants(!0,(function(e){return e instanceof W.TransformNode})).length||null!=e.mesh)&&(o._nodes.push(e),i=o._nodes.length-1,l[t.uniqueId]=i),!r.animationGroups.length&&t.animations.length&&z._GLTFAnimation._CreateNodeAnimationFromTransformNodeAnimations(t,u,c,l,o._nodes,a,o._bufferViews,o._accessors,o._convertToRightHandedSystem,o._animationSampleRate)}))})):t.name},h=0,f=e;h<f.length;h++)t(f[h]);return s.then((function(){return u.channels.length&&u.samplers.length&&o._animations.push(u),c.forEach((function(e){e.channels.length&&e.samplers.length&&o._animations.push(e)})),r.animationGroups.length&&z._GLTFAnimation._CreateNodeAnimationFromAnimationGroups(r,o._animations,l,o._nodes,a,o._bufferViews,o._accessors,o._convertToRightHandedSystem,o._animationSampleRate),l}))},u.prototype.createNodeAsync=function(r,n){var a=this;return Promise.resolve().then((function(){var e={},t={primitives:[]};return r.name&&(e.name=r.name),a.setNodeTransformation(e,r),a.setPrimitiveAttributesAsync(t,r,n).then((function(){return t.primitives.length&&(a._meshes.push(t),e.mesh=a._meshes.length-1),e}))}))},u._ExtensionNames=new Array,u._ExtensionFactories={},u})();z._Exporter=e;var r=(function(){function e(e){this._arrayBuffer=new ArrayBuffer(e),this._dataView=new DataView(this._arrayBuffer),this._byteOffset=0}return e.prototype.resizeBuffer=function(e){for(var t=new ArrayBuffer(e),r=new Uint8Array(this._arrayBuffer),n=new Uint8Array(t),a=0,i=n.byteLength;a<i;++a)n[a]=r[a];return this._arrayBuffer=t,this._dataView=new DataView(this._arrayBuffer),t},e.prototype.getArrayBuffer=function(){return this.resizeBuffer(this.getByteOffset())},e.prototype.getByteOffset=function(){if(null==this._byteOffset)throw new Error("Byte offset is undefined!");return this._byteOffset},e.prototype.setUInt8=function(e,t){null!=t?t<this._byteOffset?this._dataView.setUint8(t,e):W.Tools.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(this._byteOffset+1>this._arrayBuffer.byteLength&&this.resizeBuffer(2*this._arrayBuffer.byteLength),this._dataView.setUint8(this._byteOffset++,e))},e.prototype.getUInt32=function(e){if(e<this._byteOffset)return this._dataView.getUint32(e,!0);throw W.Tools.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"),new Error("BinaryWriter: byteoffset is greater than the current binary buffer length!")},e.prototype.getVector3Float32FromRef=function(e,t){t+8>this._byteOffset?W.Tools.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(e.x=this._dataView.getFloat32(t,!0),e.y=this._dataView.getFloat32(t+4,!0),e.z=this._dataView.getFloat32(t+8,!0))},e.prototype.setVector3Float32FromRef=function(e,t){t+8>this._byteOffset?W.Tools.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(this._dataView.setFloat32(t,e.x,!0),this._dataView.setFloat32(t+4,e.y,!0),this._dataView.setFloat32(t+8,e.z,!0))},e.prototype.getVector4Float32FromRef=function(e,t){t+12>this._byteOffset?W.Tools.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(e.x=this._dataView.getFloat32(t,!0),e.y=this._dataView.getFloat32(t+4,!0),e.z=this._dataView.getFloat32(t+8,!0),e.w=this._dataView.getFloat32(t+12,!0))},e.prototype.setVector4Float32FromRef=function(e,t){t+12>this._byteOffset?W.Tools.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(this._dataView.setFloat32(t,e.x,!0),this._dataView.setFloat32(t+4,e.y,!0),this._dataView.setFloat32(t+8,e.z,!0),this._dataView.setFloat32(t+12,e.w,!0))},e.prototype.setFloat32=function(e,t){isNaN(e)&&W.Tools.Error("Invalid data being written!"),null!=t&&(t<this._byteOffset?this._dataView.setFloat32(t,e,!0):W.Tools.Error("BinaryWriter: byteoffset is greater than the current binary length!")),this._byteOffset+4>this._arrayBuffer.byteLength&&this.resizeBuffer(2*this._arrayBuffer.byteLength),this._dataView.setFloat32(this._byteOffset,e,!0),this._byteOffset+=4},e.prototype.setUInt32=function(e,t){null!=t?t<this._byteOffset?this._dataView.setUint32(t,e,!0):W.Tools.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(this._byteOffset+4>this._arrayBuffer.byteLength&&this.resizeBuffer(2*this._arrayBuffer.byteLength),this._dataView.setUint32(this._byteOffset,e,!0),this._byteOffset+=4)},e})();z._BinaryWriter=r})((e=W.GLTF2||(W.GLTF2={})).Exporter||(e.Exporter={}))})(BABYLON||(BABYLON={})),(function(i){var e=(function(){function e(){this.glTFFiles={}}return e.prototype.downloadFiles=function(){function e(e,t){return-1!==e.indexOf(t,e.length-t.length)}for(var t in this.glTFFiles){var r=document.createElement("a");document.body.appendChild(r),r.setAttribute("type","hidden"),r.download=t;var n=this.glTFFiles[t],a=void 0;e(t,".glb")?a={type:"model/gltf-binary"}:e(t,".bin")?a={type:"application/octet-stream"}:e(t,".gltf")?a={type:"model/gltf+json"}:e(t,".jpeg")?a={type:i.GLTF2.ImageMimeType.JPEG}:e(t,".png")&&(a={type:i.GLTF2.ImageMimeType.PNG}),r.href=window.URL.createObjectURL(new Blob([n],a)),r.click()}},e})();i.GLTFData=e})(BABYLON||(BABYLON={})),(function(P){var u,e,t;u=P.GLTF2||(P.GLTF2={}),e=u.Exporter||(u.Exporter={}),t=(function(){function B(e){this._textureMap={},this._textureMap={},this._exporter=e}return B.FuzzyEquals=function(e,t,r){return P.Scalar.WithinEpsilon(e.r,t.r,r)&&P.Scalar.WithinEpsilon(e.g,t.g,r)&&P.Scalar.WithinEpsilon(e.b,t.b,r)},B.prototype._convertMaterialsToGLTFAsync=function(e,t,r){for(var n=[],a=0,i=e;a<i.length;a++){var o=i[a];o instanceof P.StandardMaterial?n.push(this._convertStandardMaterialAsync(o,t,r)):o instanceof P.PBRMetallicRoughnessMaterial?n.push(this._convertPBRMetallicRoughnessMaterialAsync(o,t,r)):o instanceof P.PBRMaterial?n.push(this._convertPBRMaterialAsync(o,t,r)):P.Tools.Warn("Unsupported material type: "+o.name)}return Promise.all(n).then((function(){}))},B.prototype._stripTexturesFromMaterial=function(e){var t={};if(e){t.name=e.name,t.doubleSided=e.doubleSided,t.alphaMode=e.alphaMode,t.alphaCutoff=e.alphaCutoff,t.emissiveFactor=e.emissiveFactor;var r=e.pbrMetallicRoughness;r&&(t.pbrMetallicRoughness={},t.pbrMetallicRoughness.baseColorFactor=r.baseColorFactor,t.pbrMetallicRoughness.metallicFactor=r.metallicFactor,t.pbrMetallicRoughness.roughnessFactor=r.roughnessFactor)}return t},B.prototype._hasTexturesPresent=function(e){if(e.emissiveTexture||e.normalTexture||e.occlusionTexture)return!0;var t=e.pbrMetallicRoughness;return!(!t||!t.baseColorTexture&&!t.metallicRoughnessTexture)},B.prototype._convertToGLTFPBRMetallicRoughness=function(e){var t,r,n,a,i,o,s,l=new P.Vector2(0,1),u=new P.Vector2(0,.1),c=new P.Vector2(0,.1),h=new P.Vector2(1300,.1),f=e.diffuseColor.toLinearSpace().scale(.5),p=e.alpha,m=P.Scalar.Clamp(e.specularPower,0,B._MaxSpecularPower),d=(t=m,s=Math.pow(t/h.x,.333333),r=s,n=l.y,a=u.y,i=c.y,o=h.y,(1-r)*(1-r)*(1-r)*n+3*(1-r)*(1-r)*r*a+3*(1-r)*r*r*i+r*r*r*o);return{baseColorFactor:[f.r,f.g,f.b,p],metallicFactor:0,roughnessFactor:d}},B._SolveMetallic=function(e,t,r){if(t<this._DielectricSpecular.r)return this._DielectricSpecular,0;var n=this._DielectricSpecular.r,a=e*r/(1-this._DielectricSpecular.r)+t-2*this._DielectricSpecular.r,i=a*a-4*n*(this._DielectricSpecular.r-t);return P.Scalar.Clamp((-a+Math.sqrt(i))/(2*n),0,1)},B.prototype._getAlphaMode=function(e){return e.needAlphaBlending()?MaterialAlphaMode.BLEND:e.needAlphaTesting()?MaterialAlphaMode.MASK:MaterialAlphaMode.OPAQUE},B.prototype._convertStandardMaterialAsync=function(t,e,r){var n=this._exporter._materialMap,a=this._exporter._materials,i=this._getAlphaMode(t),o=[],s=this._convertToGLTFPBRMetallicRoughness(t),l={name:t.name};if(null==t.backFaceCulling||t.backFaceCulling||(t.twoSidedLighting||P.Tools.Warn(t.name+": Back-face culling enabled and two-sided lighting disabled is not supported in glTF."),l.doubleSided=!0),r&&(t.diffuseTexture&&o.push(this._exportTextureAsync(t.diffuseTexture,e).then((function(e){e&&(s.baseColorTexture=e)}))),t.bumpTexture&&o.push(this._exportTextureAsync(t.bumpTexture,e).then((function(e){e&&(l.normalTexture=e,null!=t.bumpTexture&&1!==t.bumpTexture.level&&(l.normalTexture.scale=t.bumpTexture.level))}))),t.emissiveTexture&&(l.emissiveFactor=[1,1,1],o.push(this._exportTextureAsync(t.emissiveTexture,e).then((function(e){e&&(l.emissiveTexture=e)})))),t.ambientTexture&&o.push(this._exportTextureAsync(t.ambientTexture,e).then((function(e){if(e){var t={index:e.index};(l.occlusionTexture=t).strength=1}})))),(t.alpha<1||t.opacityTexture)&&(t.alphaMode===P.Engine.ALPHA_COMBINE?l.alphaMode=u.MaterialAlphaMode.BLEND:P.Tools.Warn(t.name+": glTF 2.0 does not support alpha mode: "+t.alphaMode.toString())),t.emissiveColor&&!B.FuzzyEquals(t.emissiveColor,P.Color3.Black(),B._Epsilon)&&(l.emissiveFactor=t.emissiveColor.asArray()),l.pbrMetallicRoughness=s,i!==MaterialAlphaMode.OPAQUE)switch(i){case MaterialAlphaMode.BLEND:l.alphaMode=u.MaterialAlphaMode.BLEND;break;case MaterialAlphaMode.MASK:l.alphaMode=u.MaterialAlphaMode.MASK,l.alphaCutoff=t.alphaCutOff;break;default:P.Tools.Warn("Unsupported alpha mode "+i)}return a.push(l),n[t.uniqueId]=a.length-1,Promise.all(o).then((function(){}))},B.prototype._convertPBRMetallicRoughnessMaterialAsync=function(t,e,r){var n=this._exporter._materialMap,a=this._exporter._materials,i=[],o={};t.baseColor&&(o.baseColorFactor=[t.baseColor.r,t.baseColor.g,t.baseColor.b,t.alpha]),null!=t.metallic&&1!==t.metallic&&(o.metallicFactor=t.metallic),null!=t.roughness&&1!==t.roughness&&(o.roughnessFactor=t.roughness);var s={name:t.name};t.doubleSided&&(s.doubleSided=t.doubleSided);var l=null;return null!=t.transparencyMode&&(l=this._getAlphaMode(t))&&l!==MaterialAlphaMode.OPAQUE&&(s.alphaMode=l)===MaterialAlphaMode.MASK&&(s.alphaCutoff=t.alphaCutOff),r&&(null!=t.baseTexture&&i.push(this._exportTextureAsync(t.baseTexture,e).then((function(e){e&&(o.baseColorTexture=e)}))),t.normalTexture&&i.push(this._exportTextureAsync(t.normalTexture,e).then((function(e){e&&(s.normalTexture=e,1!==t.normalTexture.level&&(s.normalTexture.scale=t.normalTexture.level))}))),t.occlusionTexture&&i.push(this._exportTextureAsync(t.occlusionTexture,e).then((function(e){e&&(s.occlusionTexture=e,null!=t.occlusionStrength&&(s.occlusionTexture.strength=t.occlusionStrength))}))),t.emissiveTexture&&i.push(this._exportTextureAsync(t.emissiveTexture,e).then((function(e){e&&(s.emissiveTexture=e)})))),B.FuzzyEquals(t.emissiveColor,P.Color3.Black(),B._Epsilon)&&(s.emissiveFactor=t.emissiveColor.asArray()),s.pbrMetallicRoughness=o,a.push(s),n[t.uniqueId]=a.length-1,Promise.all(i).then((function(){}))},B.prototype._createBase64FromCanvasAsync=function(t,l,u,e){var c=this;return new Promise(function(r,n){var a,e=P.Engine.TEXTURETYPE_UNSIGNED_INT,i=c._exporter._getLocalEngine();a=new P.Scene(i);var o=i.createRawTexture(t,l,u,P.Engine.TEXTUREFORMAT_RGBA,!1,!0,P.Texture.NEAREST_SAMPLINGMODE,null,e),s=new P.PostProcess("pass","pass",null,null,1,null,P.Texture.NEAREST_SAMPLINGMODE,i,!1,void 0,P.Engine.TEXTURETYPE_UNSIGNED_INT,void 0,null,!1);s.getEffect().executeWhenCompiled((function(){s.onApply=function(e){e._bindTexture("textureSampler",o)},i.setSize(l,u),a.postProcessManager.directRender([s],null),s.dispose(),o.dispose();var e=i.getRenderingCanvas();if(e)if(e.toBlob)P.Tools.ToBlob(e,(function(e){if(e){var t=new FileReader;t.onload=function(e){var t=e.target.result;a.dispose(),r(t)},t.readAsDataURL(e)}else n("gltfMaterialExporter: Failed to get blob from image canvas!")}));else{var t=e.toDataURL();r(t)}else n("Engine is missing a canvas!")}))})},B.prototype._createWhiteTexture=function(e,t,r){for(var n=new Uint8Array(e*t*4),a=0;a<n.length;a+=4)n[a]=n[a+1]=n[a+2]=n[a+3]=255;return P.RawTexture.CreateRGBATexture(n,e,t,r)},B.prototype._resizeTexturesToSameDimensions=function(e,t,r){var n,a,i=e?e.getSize():{width:0,height:0},o=t?t.getSize():{width:0,height:0};return i.width<o.width?(n=e&&e instanceof P.Texture?P.TextureTools.CreateResizedCopy(e,o.width,o.height,!0):this._createWhiteTexture(o.width,o.height,r),a=t):i.width>o.width?(a=t&&t instanceof P.Texture?P.TextureTools.CreateResizedCopy(t,i.width,i.height,!0):this._createWhiteTexture(i.width,i.height,r),n=e):(n=e,a=t),{texture1:n,texture2:a}},B.prototype._convertPixelArrayToFloat32=function(e){if(e instanceof Uint8Array){for(var t=e.length,r=new Float32Array(e.length),n=0;n<t;++n)r[n]=e[n]/255;return r}if(e instanceof Float32Array)return e;throw new Error("Unsupported pixel format!")},B.prototype._convertSpecularGlossinessTexturesToMetallicRoughnessAsync=function(e,t,r,n){var a=[];if(!e&&!t)return Promise.reject("_ConvertSpecularGlosinessTexturesToMetallicRoughness: diffuse and specular glossiness textures are not defined!");var i=e?e.getScene():t?t.getScene():null;if(i){var o=this._resizeTexturesToSameDimensions(e,t,i),s=o.texture1.getSize(),l=void 0,u=void 0,c=s.width,h=s.height,f=o.texture1.readPixels(),p=o.texture2.readPixels();if(!f)return Promise.reject("Failed to retrieve pixels from diffuse texture!");if(l=this._convertPixelArrayToFloat32(f),!p)return Promise.reject("Failed to retrieve pixels from specular glossiness texture!");for(var m=(u=this._convertPixelArrayToFloat32(p)).byteLength,d=new Uint8Array(m),T=new Uint8Array(m),g=P.Color3.Black(),_=0,y=0,x=0;x<h;++x)for(var A=0;A<c;++A){var v=4*(c*x+A),F={diffuseColor:new P.Color3(l[v],l[v+1],l[v+2]).toLinearSpace().multiply(r.diffuseColor),specularColor:new P.Color3(u[v],u[v+1],u[v+2]).toLinearSpace().multiply(r.specularColor),glossiness:u[v+3]*r.glossiness},E=this._convertSpecularGlossinessToMetallicRoughness(F);g.r=Math.max(g.r,E.baseColor.r),g.g=Math.max(g.g,E.baseColor.g),g.b=Math.max(g.b,E.baseColor.b),_=Math.max(_,E.metallic),y=Math.max(y,E.roughness),T[v]=255*E.baseColor.r,T[v+1]=255*E.baseColor.g,T[v+2]=255*E.baseColor.b,T[v+3]=o.texture1.hasAlpha?255*l[v+3]:255,d[v]=0,d[v+1]=255*E.roughness,d[v+2]=255*E.metallic,d[v+3]=255}var M={baseColor:g,metallic:_,roughness:y},b=!1,R=!1;for(x=0;x<h;++x)for(A=0;A<c;++A){var S=4*(c*x+A);T[S]/=M.baseColor.r>B._Epsilon?M.baseColor.r:1,T[S+1]/=M.baseColor.g>B._Epsilon?M.baseColor.g:1,T[S+2]/=M.baseColor.b>B._Epsilon?M.baseColor.b:1;var C=P.Color3.FromInts(T[S],T[S+1],T[S+2]).toGammaSpace();T[S]=255*C.r,T[S+1]=255*C.g,T[S+2]=255*C.b,B.FuzzyEquals(C,P.Color3.White(),B._Epsilon)||(R=!0),d[S+1]/=M.roughness>B._Epsilon?M.roughness:1,d[S+2]/=M.metallic>B._Epsilon?M.metallic:1;var V=P.Color3.FromInts(255,d[S+1],d[S+2]);B.FuzzyEquals(V,P.Color3.White(),B._Epsilon)||(b=!0)}if(b){var N=this._createBase64FromCanvasAsync(d,c,h,n).then((function(e){M.metallicRoughnessTextureBase64=e}));a.push(N)}return R&&(N=this._createBase64FromCanvasAsync(T,c,h,n).then((function(e){M.baseColorTextureBase64=e})),a.push(N)),Promise.all(a).then((function(){return M}))}return Promise.reject("_ConvertSpecularGlossinessTexturesToMetallicRoughness: Scene from textures is missing!")},B.prototype._convertSpecularGlossinessToMetallicRoughness=function(e){var t=this._getPerceivedBrightness(e.diffuseColor),r=this._getPerceivedBrightness(e.specularColor),n=1-this._getMaxComponent(e.specularColor),a=B._SolveMetallic(t,r,n),i=e.diffuseColor.scale(n/(1-B._DielectricSpecular.r)/Math.max(1-a,B._Epsilon)),o=e.specularColor.subtract(B._DielectricSpecular.scale(1-a)).scale(1/Math.max(a,B._Epsilon)),s=P.Color3.Lerp(i,o,a*a);return{baseColor:s=s.clampToRef(0,1,s),metallic:a,roughness:1-e.glossiness}},B.prototype._getPerceivedBrightness=function(e){return e?Math.sqrt(.299*e.r*e.r+.587*e.g*e.g+.114*e.b*e.b):0},B.prototype._getMaxComponent=function(e){return e?Math.max(e.r,Math.max(e.g,e.b)):0},B.prototype._convertMetalRoughFactorsToMetallicRoughnessAsync=function(e,t,r,n){var a=[],i={baseColor:e.albedoColor,metallic:e.metallic,roughness:e.roughness};return n&&(e.albedoTexture&&a.push(this._exportTextureAsync(e.albedoTexture,t).then((function(e){e&&(r.baseColorTexture=e)}))),e.metallicTexture&&a.push(this._exportTextureAsync(e.metallicTexture,t).then((function(e){e&&(r.metallicRoughnessTexture=e)})))),Promise.all(a).then((function(){return i}))},B.prototype._getGLTFTextureSampler=function(e){var t=this._getGLTFTextureWrapModesSampler(e),r=e instanceof P.Texture?e.samplingMode:null;if(null!=r)switch(r){case P.Texture.LINEAR_LINEAR:t.magFilter=TextureMagFilter.LINEAR,t.minFilter=TextureMinFilter.LINEAR;break;case P.Texture.LINEAR_NEAREST:t.magFilter=TextureMagFilter.LINEAR,t.minFilter=TextureMinFilter.NEAREST;break;case P.Texture.NEAREST_LINEAR:t.magFilter=TextureMagFilter.NEAREST,t.minFilter=TextureMinFilter.LINEAR;break;case P.Texture.NEAREST_LINEAR_MIPLINEAR:t.magFilter=TextureMagFilter.NEAREST,t.minFilter=TextureMinFilter.LINEAR_MIPMAP_LINEAR;break;case P.Texture.NEAREST_NEAREST:t.magFilter=TextureMagFilter.NEAREST,t.minFilter=TextureMinFilter.NEAREST;break;case P.Texture.NEAREST_LINEAR_MIPNEAREST:t.magFilter=TextureMagFilter.NEAREST,t.minFilter=TextureMinFilter.LINEAR_MIPMAP_NEAREST;break;case P.Texture.LINEAR_NEAREST_MIPNEAREST:t.magFilter=TextureMagFilter.LINEAR,t.minFilter=TextureMinFilter.NEAREST_MIPMAP_NEAREST;break;case P.Texture.LINEAR_NEAREST_MIPLINEAR:t.magFilter=TextureMagFilter.LINEAR,t.minFilter=TextureMinFilter.NEAREST_MIPMAP_LINEAR;break;case P.Texture.NEAREST_NEAREST_MIPLINEAR:t.magFilter=TextureMagFilter.NEAREST,t.minFilter=TextureMinFilter.NEAREST_MIPMAP_LINEAR;break;case P.Texture.LINEAR_LINEAR_MIPLINEAR:t.magFilter=TextureMagFilter.LINEAR,t.minFilter=TextureMinFilter.LINEAR_MIPMAP_LINEAR;break;case P.Texture.LINEAR_LINEAR_MIPNEAREST:t.magFilter=TextureMagFilter.LINEAR,t.minFilter=TextureMinFilter.LINEAR_MIPMAP_NEAREST;break;case P.Texture.NEAREST_NEAREST_MIPNEAREST:t.magFilter=TextureMagFilter.NEAREST,t.minFilter=TextureMinFilter.NEAREST_MIPMAP_NEAREST}return t},B.prototype._getGLTFTextureWrapMode=function(e){switch(e){case P.Texture.WRAP_ADDRESSMODE:return TextureWrapMode.REPEAT;case P.Texture.CLAMP_ADDRESSMODE:return TextureWrapMode.CLAMP_TO_EDGE;case P.Texture.MIRROR_ADDRESSMODE:return TextureWrapMode.MIRRORED_REPEAT;default:return P.Tools.Error("Unsupported Texture Wrap Mode "+e+"!"),TextureWrapMode.REPEAT}},B.prototype._getGLTFTextureWrapModesSampler=function(e){var t=this._getGLTFTextureWrapMode(e instanceof P.Texture?e.wrapU:P.Texture.WRAP_ADDRESSMODE),r=this._getGLTFTextureWrapMode(e instanceof P.Texture?e.wrapV:P.Texture.WRAP_ADDRESSMODE);return t===TextureWrapMode.REPEAT&&r===TextureWrapMode.REPEAT?{}:{wrapS:t,wrapT:r}},B.prototype._convertSpecGlossFactorsToMetallicRoughnessAsync=function(i,o,s,l){var u=this;return Promise.resolve().then((function(){var e=u._exporter._samplers,n=u._exporter._textures,t={diffuseColor:i.albedoColor||P.Color3.White(),specularColor:i.reflectivityColor||P.Color3.White(),glossiness:i.microSurface||1},a=null,r=u._getGLTFTextureSampler(i.albedoTexture);return null!=r.magFilter&&null!=r.minFilter&&null!=r.wrapS&&null!=r.wrapT&&(e.push(r),a=e.length-1),i.reflectivityTexture&&!i.useMicroSurfaceFromReflectivityMapAlpha?Promise.reject("_ConvertPBRMaterial: Glossiness values not included in the reflectivity texture are currently not supported"):(i.albedoTexture||i.reflectivityTexture)&&l?u._convertSpecularGlossinessTexturesToMetallicRoughnessAsync(i.albedoTexture,i.reflectivityTexture,t,o).then((function(e){if(e.baseColorTextureBase64){var t=u._getTextureInfoFromBase64(e.baseColorTextureBase64,"bjsBaseColorTexture_"+n.length+".png",o,i.albedoTexture?i.albedoTexture.coordinatesIndex:null,a);t&&(s.baseColorTexture=t)}if(e.metallicRoughnessTextureBase64){var r=u._getTextureInfoFromBase64(e.metallicRoughnessTextureBase64,"bjsMetallicRoughnessTexture_"+n.length+".png",o,i.reflectivityTexture?i.reflectivityTexture.coordinatesIndex:null,a);r&&(s.metallicRoughnessTexture=r)}return e})):u._convertSpecularGlossinessToMetallicRoughness(t)}))},B.prototype._convertPBRMaterialAsync=function(t,r,n){var a=this,i={},o={name:t.name};return t.isMetallicWorkflow()?(t.albedoColor&&(i.baseColorFactor=[t.albedoColor.r,t.albedoColor.g,t.albedoColor.b,t.alpha]),this._convertMetalRoughFactorsToMetallicRoughnessAsync(t,r,i,n).then((function(e){return a.setMetallicRoughnessPbrMaterial(e,t,o,i,r,n)}))):this._convertSpecGlossFactorsToMetallicRoughnessAsync(t,r,i,n).then((function(e){return a.setMetallicRoughnessPbrMaterial(e,t,o,i,r,n)}))},B.prototype.setMetallicRoughnessPbrMaterial=function(e,r,n,t,a,i){var o=this._exporter._materialMap,s=this._exporter._materials,l=[];if(e){var u=null;if(null!=r.transparencyMode&&(u=this._getAlphaMode(r))&&u!==MaterialAlphaMode.OPAQUE&&(n.alphaMode=u)===MaterialAlphaMode.MASK&&(n.alphaCutoff=r.alphaCutOff),B.FuzzyEquals(e.baseColor,P.Color3.White(),B._Epsilon)&&r.alpha>=B._Epsilon||(t.baseColorFactor=[e.baseColor.r,e.baseColor.g,e.baseColor.b,r.alpha]),null!=e.metallic&&1!==e.metallic&&(t.metallicFactor=e.metallic),null!=e.roughness&&1!==e.roughness&&(t.roughnessFactor=e.roughness),null==r.backFaceCulling||r.backFaceCulling||(r.twoSidedLighting||P.Tools.Warn(r.name+": Back-face culling enabled and two-sided lighting disabled is not supported in glTF."),n.doubleSided=!0),i){if(r.bumpTexture){var c=this._exportTextureAsync(r.bumpTexture,a).then((function(e){e&&(n.normalTexture=e,1!==r.bumpTexture.level&&(n.normalTexture.scale=r.bumpTexture.level))}));l.push(c)}r.ambientTexture&&(c=this._exportTextureAsync(r.ambientTexture,a).then((function(e){if(e){var t={index:e.index};n.occlusionTexture=t,r.ambientTextureStrength&&(t.strength=r.ambientTextureStrength)}})),l.push(c)),r.emissiveTexture&&(c=this._exportTextureAsync(r.emissiveTexture,a).then((function(e){e&&(n.emissiveTexture=e)})),l.push(c))}B.FuzzyEquals(r.emissiveColor,P.Color3.Black(),B._Epsilon)||(n.emissiveFactor=r.emissiveColor.asArray()),n.pbrMetallicRoughness=t,s.push(n),o[r.uniqueId]=s.length-1}return Promise.all(l).then((function(e){}))},B.prototype.getPixelsFromTexture=function(e){return e.textureType,P.Engine.TEXTURETYPE_UNSIGNED_INT,e.readPixels()},B.prototype._exportTextureAsync=function(t,r){var n=this,e=this._exporter._extensionsPreExportTextureAsync("exporter",t,r);return e?e.then((function(e){return e?n._exportTextureInfoAsync(e,r):n._exportTextureInfoAsync(t,r)})):this._exportTextureInfoAsync(t,r)},B.prototype._exportTextureInfoAsync=function(u,c){var h=this;return Promise.resolve().then((function(){var r=u.uid;if(r in h._textureMap)return h._textureMap[r];for(var e=h._exporter._samplers,t=h._getGLTFTextureSampler(u),n=null,a=null,i=0;i<e.length;++i){var o=e[i];if(o.minFilter===t.minFilter&&o.magFilter===t.magFilter&&o.wrapS===t.wrapS&&o.wrapT===t.wrapT){a=i;break}}n=null==a?(e.push(t),e.length-1):a;var s=h.getPixelsFromTexture(u),l=u.getSize();return h._createBase64FromCanvasAsync(s,l.width,l.height,c).then((function(e){var t=h._getTextureInfoFromBase64(e,u.name.replace(/\.\/|\/|\.\\|\\/g,"_"),c,u.coordinatesIndex,n);return t&&(h._textureMap[r]=t),t}))}))},B.prototype._getTextureInfoFromBase64=function(e,t,r,n,a){var i=this._exporter._textures,o=this._exporter._images,s=this._exporter._imageData,l=null,u={source:o.length,name:t};null!=a&&(u.sampler=a);for(var c=atob(e.split(",")[1]),h=new ArrayBuffer(c.length),f=new Uint8Array(h),p=0,m=c.length;p<m;++p)f[p]=c.charCodeAt(p);var d={data:f,mimeType:r},T=r===ImageMimeType.JPEG?".jpeg":".png",g=t+T;if(g in s&&(g=t+"_"+P.Tools.RandomId()+T),s[g]=d,r===ImageMimeType.JPEG||r===ImageMimeType.PNG){var _={name:t,uri:g},y=null;for(p=0;p<o.length;++p)if(o[p].uri===g){y=p;break}u.source=null==y?(o.push(_),o.length-1):y,i.push(u),l={index:i.length-1},null!=n&&(l.texCoord=n)}else P.Tools.Error("Unsupported texture mime type "+r);return l},B._DielectricSpecular=new P.Color3(.04,.04,.04),B._MaxSpecularPower=1024,B._Epsilon=1e-6,B})(),e._GLTFMaterialExporter=t})(BABYLON||(BABYLON={})),(function(b){var e;(function(F){var f,e;(e=f||(f={}))[e.INTANGENT=0]="INTANGENT",e[e.OUTTANGENT=1]="OUTTANGENT";var t=(function(){function M(){}return M._CreateNodeAnimation=function(e,t,r,n,a,i){var o=[],s=[],l=t.getKeys(),u=M.calculateMinMaxKeyFrames(l),c=M._DeduceInterpolation(l,r,a),h=u.max-u.min,f=c.interpolationType,p=c.shouldBakeAnimation;return p?M._CreateBakedAnimation(e,t,r,u.min,u.max,t.framePerSecond,i,o,s,u,n,a):f===AnimationSamplerInterpolation.LINEAR||f===AnimationSamplerInterpolation.STEP?M._CreateLinearOrStepAnimation(e,t,r,h,o,s,n,a):f===AnimationSamplerInterpolation.CUBICSPLINE?M._CreateCubicSplineAnimation(e,t,r,h,o,s,n,a):M._CreateBakedAnimation(e,t,r,u.min,u.max,t.framePerSecond,i,o,s,u,n,a),o.length&&s.length?{inputs:o,outputs:s,samplerInterpolation:f,inputsMin:p?u.min:b.Tools.FloatRound(u.min/t.framePerSecond),inputsMax:p?u.max:b.Tools.FloatRound(u.max/t.framePerSecond)}:null},M._DeduceAnimationInfo=function(e){var t=null,r=AccessorType.VEC3,n=!1,a=e.targetProperty.split(".");switch(a[0]){case"scaling":t=AnimationChannelTargetPath.SCALE;break;case"position":t=AnimationChannelTargetPath.TRANSLATION;break;case"rotation":r=AccessorType.VEC4,t=AnimationChannelTargetPath.ROTATION;break;case"rotationQuaternion":r=AccessorType.VEC4,n=!0,t=AnimationChannelTargetPath.ROTATION;break;default:b.Tools.Error("Unsupported animatable property "+a[0])}return t?{animationChannelTargetPath:t,dataAccessorType:r,useQuaternion:n}:(b.Tools.Error("animation channel target path and data accessor type could be deduced"),null)},M._CreateNodeAnimationFromTransformNodeAnimations=function(e,t,r,n,a,i,o,s,l,u){var c;if(e.animations)for(var h=0,f=e.animations;h<f.length;h++){var p=f[h],m=M._DeduceAnimationInfo(p);m&&(c={name:p.name,samplers:[],channels:[]},M.AddAnimation(""+p.name,p.hasRunningRuntimeAnimations?t:c,e,p,m.dataAccessorType,m.animationChannelTargetPath,n,i,o,s,l,m.useQuaternion,u),c.samplers.length&&c.channels.length&&r.push(c))}},M._CreateNodeAnimationFromAnimationGroups=function(e,t,r,n,a,i,o,s,l){var u;if(e.animationGroups)for(var c=0,h=e.animationGroups;c<h.length;c++){var f=h[c];u={name:f.name,channels:[],samplers:[]};for(var p=0,m=f.targetedAnimations;p<m.length;p++){var d=m[p],T=d.target,g=d.animation;if(T instanceof b.Mesh||1===T.length&&T[0]instanceof b.Mesh){var _=M._DeduceAnimationInfo(d.animation);if(_){var y=T instanceof b.Mesh?T:T[0];M.AddAnimation(""+g.name,u,y,g,_.dataAccessorType,_.animationChannelTargetPath,r,a,i,o,s,_.useQuaternion,l)}}}u.channels.length&&u.samplers.length&&t.push(u)}},M.AddAnimation=function(e,t,r,n,a,i,o,s,l,u,c,h,f){var p,m,d,T,g,_,y,x=M._CreateNodeAnimation(r,n,i,c,h,f);if(x){var A=o[r.uniqueId],v=4*x.inputs.length;p=F._GLTFUtilities._CreateBufferView(0,s.getByteOffset(),v,void 0,e+"  keyframe data view"),l.push(p),x.inputs.forEach((function(e){s.setFloat32(e)})),m=F._GLTFUtilities._CreateAccessor(l.length-1,e+"  keyframes",AccessorType.SCALAR,AccessorComponentType.FLOAT,x.inputs.length,null,[x.inputsMin],[x.inputsMax]),u.push(m),d=u.length-1,g=x.outputs.length,v=a===AccessorType.VEC3?12*x.outputs.length:16*x.outputs.length,p=F._GLTFUtilities._CreateBufferView(0,s.getByteOffset(),v,void 0,e+"  data view"),l.push(p),x.outputs.forEach((function(e){e.forEach((function(e){s.setFloat32(e)}))})),m=F._GLTFUtilities._CreateAccessor(l.length-1,e+"  data",a,AccessorComponentType.FLOAT,g,null,null,null),u.push(m),T=u.length-1,_={interpolation:x.samplerInterpolation,input:d,output:T},t.samplers.push(_),y={sampler:t.samplers.length-1,target:{node:A,path:i}},t.channels.push(y)}},M._CreateBakedAnimation=function(e,t,r,n,a,i,o,s,l,u,c,h){var f,p,m=b.Quaternion.Identity(),d=null,T=null,g=null,_=null,y=null,x=null;u.min=b.Tools.FloatRound(n/i);for(var A=t.getKeys(),v=0,F=A.length;v<F;++v){if(x=null,g=A[v],v+1<F)if(_=A[v+1],g.value.equals(_.value)){if(0!==v)continue;x=g.frame}else x=_.frame;else{if(y=A[v-1],g.value.equals(y.value))continue;x=a}if(x)for(var E=g.frame;E<=x;E+=o)(p=b.Tools.FloatRound(E/i))!==d&&(T=d=p,f=t._interpolate(E,0,void 0,t.loopMode),M._SetInterpolatedValue(e,f,p,t,r,m,s,l,c,h))}T&&(u.max=T)},M._ConvertFactorToVector3OrQuaternion=function(e,t,r,n,a,i,o){var s,l,u=null,c=M._GetBasePositionRotationOrScale(t,a,i,o);if(n===b.Animation.ANIMATIONTYPE_FLOAT)switch(l=(s=r.targetProperty.split("."))?s[1]:"",u=o?b.Quaternion.FromArray(c).normalize():b.Vector3.FromArray(c),l){case"x":case"y":u[l]=i&&o&&a!==AnimationChannelTargetPath.SCALE?-e:e;break;case"z":u[l]=i&&!o&&a!==AnimationChannelTargetPath.SCALE?-e:e;break;case"w":u.w=e;break;default:b.Tools.Error('glTFAnimation: Unsupported component type "'+l+'" for scale animation!')}return u},M._SetInterpolatedValue=function(e,t,r,n,a,i,o,s,l,u){var c,h=n.dataType;o.push(r),"number"==typeof t&&(t=this._ConvertFactorToVector3OrQuaternion(t,e,n,h,a,l,u)),t&&(a===AnimationChannelTargetPath.ROTATION?(u?i=t:(c=t,b.Quaternion.RotationYawPitchRollToRef(c.y,c.x,c.z,i)),l&&(F._GLTFUtilities._GetRightHandedQuaternionFromRef(i),e.parent||(i=b.Quaternion.FromArray([0,1,0,0]).multiply(i))),s.push(i.asArray())):(c=t,l&&a!==AnimationChannelTargetPath.SCALE&&(F._GLTFUtilities._GetRightHandedPositionVector3FromRef(c),e.parent||(c.x*=-1,c.z*=-1)),s.push(c.asArray())))},M._CreateLinearOrStepAnimation=function(e,t,r,n,a,i,o,s){for(var l=0,u=t.getKeys();l<u.length;l++){var c=u[l];a.push(c.frame/t.framePerSecond),M._AddKeyframeValue(c,t,i,r,e,o,s)}},M._CreateCubicSplineAnimation=function(t,r,n,a,i,o,s,l){r.getKeys().forEach((function(e){i.push(e.frame/r.framePerSecond),M.AddSplineTangent(t,f.INTANGENT,o,n,AnimationSamplerInterpolation.CUBICSPLINE,e,a,l,s),M._AddKeyframeValue(e,r,o,n,t,s,l),M.AddSplineTangent(t,f.OUTTANGENT,o,n,AnimationSamplerInterpolation.CUBICSPLINE,e,a,l,s)}))},M._GetBasePositionRotationOrScale=function(e,t,r,n){var a;return t===AnimationChannelTargetPath.ROTATION?n?e.rotationQuaternion?(a=e.rotationQuaternion.asArray(),r&&(F._GLTFUtilities._GetRightHandedQuaternionArrayFromRef(a),e.parent||(a=b.Quaternion.FromArray([0,1,0,0]).multiply(b.Quaternion.FromArray(a)).asArray()))):a=b.Quaternion.Identity().asArray():(a=e.rotation.asArray(),F._GLTFUtilities._GetRightHandedNormalArray3FromRef(a)):t===AnimationChannelTargetPath.TRANSLATION?(a=e.position.asArray(),r&&F._GLTFUtilities._GetRightHandedPositionArray3FromRef(a)):a=e.scaling.asArray(),a},M._AddKeyframeValue=function(e,t,r,n,a,i,o){var s,l,u=t.dataType;if(u===b.Animation.ANIMATIONTYPE_VECTOR3){if(s=e.value.asArray(),n===AnimationChannelTargetPath.ROTATION){var c=b.Vector3.FromArray(s),h=b.Quaternion.RotationYawPitchRoll(c.y,c.x,c.z);i&&(F._GLTFUtilities._GetRightHandedQuaternionFromRef(h),a.parent||(h=b.Quaternion.FromArray([0,1,0,0]).multiply(h))),s=h.asArray()}else n===AnimationChannelTargetPath.TRANSLATION&&i&&(F._GLTFUtilities._GetRightHandedNormalArray3FromRef(s),a.parent||(s[0]*=-1,s[2]*=-1));r.push(s)}else if(u===b.Animation.ANIMATIONTYPE_FLOAT){if(l=this._ConvertFactorToVector3OrQuaternion(e.value,a,t,u,n,i,o)){if(n===AnimationChannelTargetPath.ROTATION){var f=o?l:b.Quaternion.RotationYawPitchRoll(l.y,l.x,l.z).normalize();i&&(F._GLTFUtilities._GetRightHandedQuaternionFromRef(f),a.parent||(f=b.Quaternion.FromArray([0,1,0,0]).multiply(f))),r.push(f.asArray())}else n===AnimationChannelTargetPath.TRANSLATION&&i&&(F._GLTFUtilities._GetRightHandedNormalVector3FromRef(l),a.parent||(l.x*=-1,l.z*=-1));r.push(l.asArray())}}else u===b.Animation.ANIMATIONTYPE_QUATERNION?(s=e.value.normalize().asArray(),i&&(F._GLTFUtilities._GetRightHandedQuaternionArrayFromRef(s),a.parent||(s=b.Quaternion.FromArray([0,1,0,0]).multiply(b.Quaternion.FromArray(s)).asArray())),r.push(s)):b.Tools.Error("glTFAnimation: Unsupported key frame values for animation!")},M._DeduceInterpolation=function(e,t,r){var n,a,i=!1;if(t===AnimationChannelTargetPath.ROTATION&&!r)return{interpolationType:AnimationSamplerInterpolation.LINEAR,shouldBakeAnimation:!0};for(var o=0,s=e.length;o<s;++o)if((a=e[o]).inTangent||a.outTangent)if(n){if(n!==AnimationSamplerInterpolation.CUBICSPLINE){n=AnimationSamplerInterpolation.LINEAR,i=!0;break}}else n=AnimationSamplerInterpolation.CUBICSPLINE;else if(n){if(n===AnimationSamplerInterpolation.CUBICSPLINE||a.interpolation&&a.interpolation===b.AnimationKeyInterpolation.STEP&&n!==AnimationSamplerInterpolation.STEP){n=AnimationSamplerInterpolation.LINEAR,i=!0;break}}else n=a.interpolation&&a.interpolation===b.AnimationKeyInterpolation.STEP?AnimationSamplerInterpolation.STEP:AnimationSamplerInterpolation.LINEAR;return n||(n=AnimationSamplerInterpolation.LINEAR),{interpolationType:n,shouldBakeAnimation:i}},M.AddSplineTangent=function(e,t,r,n,a,i,o,s,l){var u,c=t===f.INTANGENT?i.inTangent:i.outTangent;if(a===AnimationSamplerInterpolation.CUBICSPLINE){if(n===AnimationChannelTargetPath.ROTATION)if(c){if(s)u=c.scale(o).asArray();else{var h=c.scale(o);u=b.Quaternion.RotationYawPitchRoll(h.y,h.x,h.z).asArray()}l&&(F._GLTFUtilities._GetRightHandedQuaternionArrayFromRef(u),e.parent||(u=b.Quaternion.FromArray([0,1,0,0]).multiply(b.Quaternion.FromArray(u)).asArray()))}else u=[0,0,0,0];else c?(u=c.scale(o).asArray(),l&&n===AnimationChannelTargetPath.TRANSLATION&&(F._GLTFUtilities._GetRightHandedPositionArray3FromRef(u),e.parent||(u[0]*=-1,u[2]*=-1))):u=[0,0,0];r.push(u)}},M.calculateMinMaxKeyFrames=function(e){var t=1/0,r=-1/0;return e.forEach((function(e){t=Math.min(t,e.frame),r=Math.max(r,e.frame)})),{min:t,max:r}},M})();F._GLTFAnimation=t})((e=b.GLTF2||(b.GLTF2={})).Exporter||(e.Exporter={}))})(BABYLON||(BABYLON={})),(function(m){var e,t,r;e=m.GLTF2||(m.GLTF2={}),t=e.Exporter||(e.Exporter={}),r=(function(){function p(){}return p._CreateBufferView=function(e,t,r,n,a){var i={buffer:e,byteLength:r};return t&&(i.byteOffset=t),a&&(i.name=a),n&&(i.byteStride=n),i},p._CreateAccessor=function(e,t,r,n,a,i,o,s){var l={name:t,bufferView:e,componentType:n,count:a,type:r};return null!=o&&(l.min=o),null!=s&&(l.max=s),null!=i&&(l.byteOffset=i),l},p._CalculateMinMaxPositions=function(e,t,r,n){var a,i,o,s=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];if(r)for(var u=t,c=t+r;u<c;++u){a=3*u,i=m.Vector3.FromArray(e,a),n&&p._GetRightHandedPositionVector3FromRef(i),o=i.asArray();for(var h=0;h<3;++h){var f=o[h];f<s[h]&&(s[h]=f),f>l[h]&&(l[h]=f),++a}}return{min:s,max:l}},p._GetRightHandedPositionVector3=function(e){return new m.Vector3(e.x,e.y,-e.z)},p._GetRightHandedPositionVector3FromRef=function(e){e.z*=-1},p._GetRightHandedPositionArray3FromRef=function(e){e[2]*=-1},p._GetRightHandedNormalVector3=function(e){return new m.Vector3(e.x,e.y,-e.z)},p._GetRightHandedNormalVector3FromRef=function(e){e.z*=-1},p._GetRightHandedNormalArray3FromRef=function(e){e[2]*=-1},p._GetRightHandedVector4FromRef=function(e){e.z*=-1,e.w*=-1},p._GetRightHandedArray4FromRef=function(e){e[2]*=-1,e[3]*=-1},p._GetRightHandedQuaternionFromRef=function(e){e.x*=-1,e.y*=-1},p._GetRightHandedQuaternionArrayFromRef=function(e){e[0]*=-1,e[1]*=-1},p._NormalizeTangentFromRef=function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);0<t&&(e.x/=t,e.y/=t,e.z/=t)},p})(),t._GLTFUtilities=r})(BABYLON||(BABYLON={})),(function(c){var e,t,r,n,a;e=c.GLTF2||(c.GLTF2={}),t=e.Exporter||(e.Exporter={}),r=t.Extensions||(t.Extensions={}),n="KHR_texture_transform",a=(function(){function e(e){this.name=n,this.enabled=!0,this.required=!1,this._exporter=e}return e.prototype.dispose=function(){delete this._exporter},e.prototype.preExportTextureAsync=function(s,l,e){var u=this;return new Promise(function(t,e){var r={};0===l.uOffset&&0===l.vOffset||(r.offset=[l.uOffset,l.vOffset]),1===l.uScale&&1===l.vScale||(r.scale=[l.uScale,l.vScale]),0!==l.wAng&&(r.rotation=l.wAng),Object.keys(r).length||t(l);var n=r.scale?new c.Vector2(r.scale[0],r.scale[1]):c.Vector2.One(),a=null!=r.rotation?r.rotation:0,i=r.offset?new c.Vector2(r.offset[0],r.offset[1]):c.Vector2.Zero(),o=l.getScene();o?u.textureTransformTextureAsync(l,i,a,n,o).then((function(e){t(e)})):e(s+': "scene" is not defined for Babylon texture '+l.name+"!")})},e.prototype.textureTransformTextureAsync=function(n,e,t,r,a){return new Promise(function(e,t){var r=new c.ProceduralTexture(""+n.name,n.getSize(),"textureTransform",a);r||(c.Tools.Log("Cannot create procedural texture for "+n.name+"!"),e(n)),r.setTexture("textureSampler",n),r.setMatrix("textureTransformMat",n.getTextureMatrix()),r.isReady()?(r.render(),e(r)):r.getEffect().executeWhenCompiled((function(){r.render(),e(r)}))})},e})(),r.KHR_texture_transform=a,t._Exporter.RegisterExtension(n,(function(e){return new a(e)}))})(BABYLON||(BABYLON={}));